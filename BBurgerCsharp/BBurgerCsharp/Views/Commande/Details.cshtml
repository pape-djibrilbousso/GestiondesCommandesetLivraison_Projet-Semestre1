@model BBurgerCsharp.Web.Models.Commande

@{
    ViewData["Title"] = $"Commande #{Model.Id}";
}

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a asp-action="Index">Mes Commandes</a></li>
        <li class="breadcrumb-item active">Commande #@Model.Id</li>
    </ol>
</nav>

<div class="row">
    <div class="col-md-8">
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-danger text-white">
                <h4 class="mb-0">
                    <i class="fas fa-shopping-bag"></i> Commande #@Model.Id
                    @switch (Model.Etat)
                    {
                        case "en_cours":
                            <span class="badge bg-light text-dark float-end">En cours</span>
                            break;
                        case "validee":
                            <span class="badge bg-success float-end">Validée</span>
                            break;
                        case "terminee":
                            <span class="badge bg-dark float-end">Terminée</span>
                            break;
                        case "annulee":
                            <span class="badge bg-warning text-dark float-end">Annulée</span>
                            break;
                    }
                </h4>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <p><strong>Date :</strong> @Model.DateCommande.ToString("dd/MM/yyyy à HH:mm")</p>
                        <p><strong>Client :</strong> @Model.Client?.NomComplet</p>
                        <p><strong>Téléphone :</strong> @Model.Client?.Telephone</p>
                    </div>
                    <div class="col-md-6">
                        <p>
                            <strong>Type de livraison :</strong>
                            @Model.TypeLivraison switch
                            {
                                "sur_place" => "Sur place",
                                "a_emporter" => "À emporter",
                                "livraison" => "Livraison",
                                _ => Model.TypeLivraison
                            }
                        </p>
                        @if (Model.Zone != null)
                        {
                            <p><strong>Zone :</strong> @Model.Zone.Nom</p>
                            <p><strong>Frais de livraison :</strong> @Model.Zone.PrixFormate</p>
                        }
                    </div>
                </div>

                <hr>

                <h5 class="mb-3"><i class="fas fa-list"></i> Détails de la commande</h5>
                
                @if (Model.LigneCommandes.Any())
                {
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Produit</th>
                                <th>Type</th>
                                <th>Prix unitaire</th>
                                <th>Quantité</th>
                                <th>Sous-total</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var ligne in Model.LigneCommandes)
                            {
                                <tr>
                                    <td>Produit #@ligne.ProduitId</td>
                                    <td>
                                        @if (ligne.TypeProduit == "burger")
                                        {
                                            <span class="badge bg-danger">Burger</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-warning text-dark">Menu</span>
                                        }
                                    </td>
                                    <td>@ligne.PrixUnitaire.ToString("N0") FCFA</td>
                                    <td>@ligne.Quantite</td>
                                    <td><strong>@ligne.SousTotal.ToString("N0") FCFA</strong></td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }

                @if (Model.CommandeComplements.Any())
                {
                    <h6 class="mt-4"><i class="fas fa-plus-circle"></i> Compléments</h6>
                    <ul class="list-unstyled">
                        @foreach (var cc in Model.CommandeComplements)
                        {
                            <li>
                                <i class="fas fa-check text-success"></i>
                                @cc.Complement?.Nom (x@cc.Quantite) - @((cc.Complement?.Prix * cc.Quantite)?.ToString("N0")) FCFA
                            </li>
                        }
                    </ul>
                }
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card shadow-sm mb-3">
            <div class="card-header bg-light">
                <h5 class="mb-0"><i class="fas fa-receipt"></i> Récapitulatif</h5>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between mb-2">
                    <span>Montant total :</span>
                    <strong class="text-danger fs-5">@Model.MontantFormate</strong>
                </div>

                <hr>

                @if (Model.Paiement != null)
                {
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle"></i> <strong>Commande payée</strong>
                        <p class="mb-0 small">
                            Via @Model.Paiement.MoyenPaiement<br>
                            Le @Model.Paiement.DatePaiement.ToString("dd/MM/yyyy à HH:mm")
                        </p>
                    </div>
                }
                else
                {
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i> Commande non payée
                    </div>
                }

                @if (Model.Etat == "en_cours")
                {
                    <form asp-action="Annuler" asp-route-id="@Model.Id" method="post" class="mt-3">
                        <div class="d-grid">
                            <button type="submit" class="btn btn-outline-danger" 
                                    onclick="return confirm('Êtes-vous sûr de vouloir annuler cette commande ?')">
                                <i class="fas fa-times-circle"></i> Annuler la commande
                            </button>
                        </div>
                    </form>
                }
            </div>
        </div>
            <div class="card shadow-sm">
                <div class="card-body text-center">
                    <a asp-action="Index" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Retour à mes commandes
                    </a>
                </div>
            </div>
        </div>